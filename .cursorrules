# Android English Learning App - Project Rules

## Project Overview
English vocabulary learning mobile application built with **Kotlin** and **Jetpack Compose**.
Package: `com.uilover.project247`

## Tech Stack
- **Language**: Kotlin 2.0
- **UI Framework**: Jetpack Compose (Material3)
- **Architecture**: MVVM (Model-View-ViewModel)
- **Min SDK**: 24, **Target SDK**: 36
- **Backend**: Firebase Realtime Database
- **Image Loading**: Coil 2.5.0
- **API**: 
  - Free Dictionary API (https://api.dictionaryapi.dev/)
  - Unsplash for images
- **Networking**: Retrofit 2.9.0 + Gson
- **Build System**: Gradle (Kotlin DSL)

## Project Structure

```
app/src/main/java/com/uilover/project247/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ models/          # Data classes (Firebase models, Dictionary models)
â”‚   â”‚   â”œâ”€â”€ FirebaseModels.kt    # Topic, Flashcard, Conversation
â”‚   â”‚   â””â”€â”€ DictionaryModels.kt  # DictionaryEntry, Meaning, Definition
â”‚   â”œâ”€â”€ repository/      # Data access layer
â”‚   â”‚   â””â”€â”€ FirebaseRepository.kt
â”‚   â””â”€â”€ api/             # API services
â”‚       â””â”€â”€ DictionaryApiService.kt
â”‚
â”œâ”€â”€ utils/               # Utility functions
â”‚   â”œâ”€â”€ Helper.kt        # parseHtmlToAnnotatedString, getWordTypeAbbreviation
â”‚   â””â”€â”€ TextToSpeechManager.kt
â”‚
â”œâ”€â”€ DashboardActivity/   # Main screen - Topic list
â”‚   â”œâ”€â”€ MainActivity.kt
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â””â”€â”€ MainScreen.kt
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ TopicItem.kt
â”‚   â”‚   â”œâ”€â”€ BottomNavigationBarStub.kt
â”‚   â”‚   â””â”€â”€ DictionaryScreenContent.kt
â”‚   â””â”€â”€ Model/
â”‚       â””â”€â”€ MainViewModel.kt
â”‚
â”œâ”€â”€ LearningActivity/    # Learning screen - Flashcards
â”‚   â”œâ”€â”€ LearningActivity.kt
â”‚   â”œâ”€â”€ LearningScreen.kt
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ FlashcardView.kt
â”‚   â”‚   â”œâ”€â”€ WriteWordView.kt
â”‚   â”‚   â””â”€â”€ MultipleChoiceView.kt
â”‚   â””â”€â”€ Model/
â”‚       â”œâ”€â”€ LearningViewModel.kt
â”‚       â””â”€â”€ LearningUiState.kt
â”‚
â”œâ”€â”€ ReviewActivity/      # Review screen
â”‚   â”œâ”€â”€ ReviewActivity.kt
â”‚   â””â”€â”€ Model/
â”‚       â””â”€â”€ ReviewViewModel.kt
â”‚
â”œâ”€â”€ DictionaryActivity/  # Dictionary lookup screen
â”‚   â”œâ”€â”€ DictionaryActivity.kt
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â””â”€â”€ DictionaryScreen.kt
â”‚   â””â”€â”€ Model/
â”‚       â””â”€â”€ DictionaryViewModel.kt
â”‚
â””â”€â”€ ui/theme/           # Theme configuration
    â””â”€â”€ Theme.kt
```

## Architecture Patterns

### MVVM Pattern
- **Model**: Data classes in `data/models/`
- **View**: Composable functions in `screens/` and `components/`
- **ViewModel**: Business logic in `Model/` folders
  - Use `StateFlow` for state management
  - Inject repositories for data access

### Data Flow
```
Firebase/API â†’ Repository â†’ ViewModel â†’ UI State â†’ Composable UI
```

### State Management
- Use `StateFlow<UiState>` in ViewModels
- Collect state with `collectAsState()` in Composables
- Update state with `_uiState.update { ... }`

## Coding Conventions

### File Naming
- **Activities**: `[Feature]Activity.kt` (e.g., `LearningActivity.kt`)
- **Screens**: `[Feature]Screen.kt` (e.g., `MainScreen.kt`)
- **Components**: Descriptive names (e.g., `FlashcardView.kt`, `TopicItem.kt`)
- **ViewModels**: `[Feature]ViewModel.kt`
- **UI States**: `[Feature]UiState.kt`

### Composable Functions
```kotlin
@Composable
fun FeatureName(
    viewModel: FeatureViewModel,
    onAction: () -> Unit,
    modifier: Modifier = Modifier
) {
    val uiState by viewModel.uiState.collectAsState()
    // UI implementation
}
```

### ViewModel Pattern
```kotlin
class FeatureViewModel : ViewModel() {
    private val _uiState = MutableStateFlow(FeatureUiState())
    val uiState: StateFlow<FeatureUiState> = _uiState.asStateFlow()
    
    fun updateState() {
        _uiState.update { it.copy(/* changes */) }
    }
}
```

### Color Scheme
- **Primary Purple**: `#6200EA`
- **Light Purple**: `#EDE7F6`
- **Blue**: `#1976D2`
- **Green**: `#4CAF50`
- **Background**: `#F5F5F5`
- Use `MaterialTheme.colorScheme` when possible

### Spacing & Sizes
- **Card padding**: 16-20dp
- **Item spacing**: 8-16dp
- **Corner radius**: 12-16dp
- **Icon sizes**: 20-28dp
- **Button height**: 48-56dp

## Key Features

### 1. Topic Learning
- Display topics from Firebase
- Each topic has flashcards and conversations
- Click topic â†’ Navigate to LearningActivity

### 2. Flashcard Learning
- **Front side**: Image + HTML context sentence (with `<b><u>` tags)
- **Back side**: word + pronunciation + meaning + (word type abbreviation)
- Flip animation with 3D rotation
- Audio playback for pronunciation
- Parse HTML with `parseHtmlToAnnotatedString()`

### 3. Dictionary Lookup
- Search English words via Free Dictionary API
- Display: phonetics, definitions, examples, synonyms, antonyms, origin
- Recent search history (last 10 searches)
- Integrated in bottom navigation tab

### 4. Progress Tracking
- User progress stored in Firebase
- Track learned words, scores, timestamps

## Firebase Structure

```json
{
  "topics": {
    "topic1": {
      "id": "topic1",
      "name": "Daily Routine",
      "nameVi": "Hoáº¡t Ä‘á»™ng hÃ ng ngÃ y",
      "description": "...",
      "imageUrl": "https://...",
      "order": 1,
      "totalWords": 10
    }
  },
  "flashcards": {
    "flashcard1": {
      "id": "flashcard1",
      "topicId": "topic1",
      "word": "breakfast",
      "pronunciation": "/ËˆbrekfÉ™st/",
      "meaning": "bá»¯a sÃ¡ng",
      "wordType": "noun",
      "contextSentence": "I usually have <b><u>breakfast</u></b> at 7 AM",
      "imageUrl": "https://..."
    }
  }
}
```

## Important Rules

### When Creating New Features
1. Follow MVVM architecture
2. Create ViewModel with StateFlow
3. Use Composables for UI
4. Add navigation in MainActivity or parent activity
5. Update bottom navigation if needed

### When Modifying UI
1. Use Material3 components
2. Follow existing color scheme
3. Use `Modifier` for layouts
4. Keep composables small and reusable
5. Use `LazyColumn` for scrollable lists

### When Working with Data
1. Define data classes in `data/models/`
2. Use `@Parcelize` for Parcelable classes
3. Create repository for data access
4. Use Retrofit for API calls
5. Use Firebase Realtime Database SDK

### When Handling State
1. Never mutate state directly
2. Use `_uiState.update { }` to change state
3. Collect state with `collectAsState()` in Composables
4. Handle loading, success, error states

### HTML Content
- Context sentences may contain HTML tags: `<b>`, `<u>`, `<i>`, `<strike>`
- Use `parseHtmlToAnnotatedString()` from `utils/Helper.kt`
- Never display raw HTML, always parse first

### Navigation
- Use `Intent` for Activity navigation
- Pass data via `intent.putExtra()`
- Bottom navigation tabs: "Tra tá»«", "Há»c tá»« vá»±ng", "Ã”n táº­p", "Há»™i thoáº¡i", "MochiHub"
- Main tab is "Há»c tá»« vá»±ng" (index 1)

## Dependencies

### Core
```kotlin
implementation(libs.androidx.core.ktx)
implementation(libs.androidx.activity.compose)
implementation(platform(libs.androidx.compose.bom))
implementation(libs.androidx.material3)
```

### Firebase
```kotlin
implementation(platform("com.google.firebase:firebase-bom:33.5.1"))
implementation("com.google.firebase:firebase-database-ktx")
```

### Networking
```kotlin
implementation("com.squareup.retrofit2:retrofit:2.9.0")
implementation("com.squareup.retrofit2:converter-gson:2.9.0")
```

### Image Loading
```kotlin
implementation("io.coil-kt:coil-compose:2.5.0")
```

## Testing Workflow
1. Build with: `./gradlew clean build`
2. Run on emulator or device
3. Test navigation flows
4. Verify Firebase connection
5. Check API calls (Dictionary API)

## Common Pitfalls to Avoid
- âŒ Don't use `crossAxisAlignment` in Row (use `verticalAlignment`)
- âŒ Don't use `crossAxisAlignment` in Column (use `horizontalAlignment`)
- âŒ Don't forget to add activities to AndroidManifest.xml
- âŒ Don't mutate StateFlow directly, use `.update { }`
- âŒ Don't forget INTERNET permission for API calls
- âŒ Don't use deprecated APIs (check warnings)
- âŒ Don't create multiple instances of Repository

## Vietnamese Language Context
This app is for Vietnamese users learning English:
- UI labels are in Vietnamese
- Word meanings are in Vietnamese
- Keep Vietnamese in UI, English in data models
- Examples: "Tra tá»«" (Dictionary), "Há»c tá»« vá»±ng" (Learn Vocabulary)

## AI Assistant Guidelines
When helping with this project:
1. Always follow MVVM pattern
2. Use Jetpack Compose (no XML layouts)
3. Keep code consistent with existing style
4. Suggest Material3 components
5. Consider Vietnamese UI context
6. Check for proper state management
7. Ensure proper navigation setup
8. Follow the project structure strictly
9. Use helper functions from `utils/` package
10. Parse HTML content when displaying

## Current Development Status
âœ… Firebase integration complete
âœ… Dictionary API integration complete
âœ… Flashcard learning with flip animation
âœ… Bottom navigation with 5 tabs
âœ… HTML parsing for rich text
âœ… Recent search history
ğŸ”„ Text-to-Speech integration (TODO)
ğŸ”„ Conversation practice (TODO)
ğŸ”„ Progress tracking UI (TODO)
