{
  "rules": {
    // ==================== TOPICS ====================
    "topics": {
      "$topicId": {
        ".read": true,
        ".write": "auth != null && auth.token.admin == true",
        ".validate": "newData.hasChildren(['id', 'name', 'nameVi', 'description', 'descriptionVi', 'imageUrl', 'order', 'totalWords', 'createdAt', 'updatedAt'])",
        "id": {
          ".validate": "newData.isString() && newData.val() == $topicId"
        },
        "name": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "nameVi": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "description": {
          ".validate": "newData.isString()"
        },
        "descriptionVi": {
          ".validate": "newData.isString()"
        },
        "imageUrl": {
          ".validate": "newData.isString() && newData.val().matches(/^https?:\\/\\/.+/)"
        },
        "order": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "totalWords": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "createdAt": {
          ".validate": "newData.isNumber()"
        },
        "updatedAt": {
          ".validate": "newData.isNumber()"
        },
        "$other": {
          ".validate": false
        }
      }
    },
    
    // ==================== FLASHCARDS ====================
    "flashcards": {
      "$flashcardId": {
        ".read": true,
        ".write": "auth != null && auth.token.admin == true",
        ".validate": "newData.hasChildren(['id', 'topicId', 'word', 'pronunciation', 'meaning', 'wordType', 'wordTypeVi', 'imageUrl', 'contextSentence', 'contextSentenceVi', 'example', 'exampleVi', 'order', 'difficulty', 'createdAt'])",
        "id": {
          ".validate": "newData.isString() && newData.val() == $flashcardId"
        },
        "topicId": {
          ".validate": "newData.isString() && root.child('topics').child(newData.val()).exists()"
        },
        "word": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "pronunciation": {
          ".validate": "newData.isString()"
        },
        "meaning": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "wordType": {
          ".validate": "newData.isString() && (newData.val() == 'noun' || newData.val() == 'verb' || newData.val() == 'adjective' || newData.val() == 'adverb' || newData.val() == 'preposition' || newData.val() == 'conjunction')"
        },
        "wordTypeVi": {
          ".validate": "newData.isString()"
        },
        "imageUrl": {
          ".validate": "newData.isString() && newData.val().matches(/^https?:\\/\\/.+/)"
        },
        "contextSentence": {
          ".validate": "newData.isString()"
        },
        "contextSentenceVi": {
          ".validate": "newData.isString()"
        },
        "example": {
          ".validate": "newData.isString()"
        },
        "exampleVi": {
          ".validate": "newData.isString()"
        },
        "order": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "difficulty": {
          ".validate": "newData.isString() && (newData.val() == 'easy' || newData.val() == 'medium' || newData.val() == 'hard')"
        },
        "createdAt": {
          ".validate": "newData.isNumber()"
        },
        "$other": {
          ".validate": false
        }
      }
    },
    
    // ==================== CONVERSATIONS ====================
    "conversations": {
      "$conversationId": {
        ".read": true,
        ".write": "auth != null && auth.token.admin == true",
        ".validate": "newData.hasChildren(['id', 'title', 'titleVi', 'imageUrl', 'contextDescription', 'contextDescriptionVi', 'dialogue', 'vocabularyWords', 'order', 'createdAt'])",
        "id": {
          ".validate": "newData.isString() && newData.val() == $conversationId"
        },
        "title": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "titleVi": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "imageUrl": {
          ".validate": "newData.isString() && newData.val().matches(/^https?:\\/\\/.+/)"
        },
        "contextDescription": {
          ".validate": "newData.isString()"
        },
        "contextDescriptionVi": {
          ".validate": "newData.isString()"
        },
        "dialogue": {
          ".validate": "newData.hasChildren()",
          "$dialogueIndex": {
            ".validate": "newData.hasChildren(['speaker', 'text', 'textVi', 'order'])",
            "speaker": {
              ".validate": "newData.isString() && newData.val().length > 0"
            },
            "text": {
              ".validate": "newData.isString() && newData.val().length > 0"
            },
            "textVi": {
              ".validate": "newData.isString() && newData.val().length > 0"
            },
            "order": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "vocabularyWord": {
              ".validate": "newData.isString() || newData.val() == null"
            },
            "question": {
              ".validate": "newData.isString() || newData.val() == null"
            },
            "questionVi": {
              ".validate": "newData.isString() || newData.val() == null"
            },
            "options": {
              ".validate": "newData.hasChildren() || newData.val() == null",
              "$optionIndex": {
                ".validate": "newData.hasChildren(['id', 'text', 'isCorrect'])",
                "id": {
                  ".validate": "newData.isString() && newData.val().length > 0"
                },
                "text": {
                  ".validate": "newData.isString() && newData.val().length > 0"
                },
                "isCorrect": {
                  ".validate": "newData.isBoolean()"
                },
                "$other": {
                  ".validate": false
                }
              }
            },
            "$other": {
              ".validate": false
            }
          }
        },
        "vocabularyWords": {
          ".validate": "newData.hasChildren()",
          "$wordIndex": {
            ".validate": "newData.hasChildren(['word', 'meaning', 'pronunciation', 'wordType', 'wordTypeVi'])",
            "word": {
              ".validate": "newData.isString() && newData.val().length > 0"
            },
            "meaning": {
              ".validate": "newData.isString() && newData.val().length > 0"
            },
            "pronunciation": {
              ".validate": "newData.isString()"
            },
            "wordType": {
              ".validate": "newData.isString()"
            },
            "wordTypeVi": {
              ".validate": "newData.isString()"
            },
            "$other": {
              ".validate": false
            }
          }
        },
        "order": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "createdAt": {
          ".validate": "newData.isNumber()"
        },
        "$other": {
          ".validate": false
        }
      }
    },
    
    // ==================== USER PROGRESS ====================
    "userProgress": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId",
        ".write": "auth != null && auth.uid == $userId",
        ".validate": "newData.hasChildren(['userId', 'displayName', 'email', 'totalPoints', 'level', 'streak', 'createdAt'])",
        "userId": {
          ".validate": "newData.isString() && newData.val() == $userId"
        },
        "displayName": {
          ".validate": "newData.isString()"
        },
        "email": {
          ".validate": "newData.isString() && newData.val().matches(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/)"
        },
        "totalPoints": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "level": {
          ".validate": "newData.isNumber() && newData.val() >= 1"
        },
        "streak": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "lastStudyDate": {
          ".validate": "newData.isNumber() || newData.val() == null"
        },
        "createdAt": {
          ".validate": "newData.isNumber()"
        },
        "topicProgress": {
          "$topicId": {
            ".validate": "newData.hasChildren(['topicId', 'completedFlashcards', 'completedConversations', 'totalFlashcards', 'totalConversations', 'progress'])",
            "topicId": {
              ".validate": "newData.isString() && root.child('topics').child(newData.val()).exists()"
            },
            "completedFlashcards": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "completedConversations": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "totalFlashcards": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "totalConversations": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "progress": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100"
            },
            "lastStudyDate": {
              ".validate": "newData.isNumber() || newData.val() == null"
            },
            "$other": {
              ".validate": false
            }
          }
        },
        "flashcardResults": {
          "$flashcardId": {
            ".validate": "newData.hasChildren(['flashcardId', 'learned', 'reviewCount', 'confidence'])",
            "flashcardId": {
              ".validate": "newData.isString() && root.child('flashcards').child(newData.val()).exists()"
            },
            "learned": {
              ".validate": "newData.isBoolean()"
            },
            "reviewCount": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "lastReviewDate": {
              ".validate": "newData.isNumber() || newData.val() == null"
            },
            "nextReviewDate": {
              ".validate": "newData.isNumber() || newData.val() == null"
            },
            "confidence": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100"
            },
            "$other": {
              ".validate": false
            }
          }
        },
        "conversationResults": {
          "$conversationId": {
            ".validate": "newData.hasChildren(['conversationId', 'completed', 'attempts', 'correctAnswers'])",
            "conversationId": {
              ".validate": "newData.isString() && root.child('conversations').child(newData.val()).exists()"
            },
            "completed": {
              ".validate": "newData.isBoolean()"
            },
            "attempts": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "correctAnswers": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "lastAttemptDate": {
              ".validate": "newData.isNumber() || newData.val() == null"
            },
            "$other": {
              ".validate": false
            }
          }
        },
        "$other": {
          ".validate": false
        }
      }
    },
    
    // ==================== SETTINGS ====================
    "settings": {
      "app": {
        ".read": true,
        ".write": "auth != null && auth.token.admin == true",
        ".validate": "newData.hasChildren(['version', 'minSupportedVersion', 'maintenanceMode', 'dailyGoal', 'reminderEnabled', 'reminderTime', 'soundEnabled', 'autoPlayAudio'])",
        "version": {
          ".validate": "newData.isString() && newData.val().matches(/^\\d+\\.\\d+\\.\\d+$/)"
        },
        "minSupportedVersion": {
          ".validate": "newData.isString() && newData.val().matches(/^\\d+\\.\\d+\\.\\d+$/)"
        },
        "maintenanceMode": {
          ".validate": "newData.isBoolean()"
        },
        "dailyGoal": {
          ".validate": "newData.isNumber() && newData.val() >= 1"
        },
        "reminderEnabled": {
          ".validate": "newData.isBoolean()"
        },
        "reminderTime": {
          ".validate": "newData.isString() && newData.val().matches(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/)"
        },
        "soundEnabled": {
          ".validate": "newData.isBoolean()"
        },
        "autoPlayAudio": {
          ".validate": "newData.isBoolean()"
        },
        "$other": {
          ".validate": false
        }
      }
    }
  }
}
